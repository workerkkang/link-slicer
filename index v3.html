<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Link Slicer - Image Line Tool</title>
<style>
  body {
    display: flex;
    margin: 0;
    font-family: Arial, sans-serif;
    height: 100vh;
  }

  /* ì™¼ìª½ ì‚¬ìš©ë²• ì˜ì—­ */
  #sidebar {
    width: 260px;
    background: #f4f4f4;
    padding: 20px;
    border-right: 1px solid #ccc;
    overflow-y: auto;
  }

  #sidebar h2 {
    margin-top: 0;
  }

  /* ë©”ì¸ ì‘ì—… ì˜ì—­ */
  #main {
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  #controls {
    padding: 10px;
    border-bottom: 1px solid #ccc;
    background: #fafafa;
  }

  #canvas-container {
    position: relative;
    flex: 1;
    overflow: auto;
    background: #ddd;
  }

  #uploadedImage {
    display: block;
    max-width: none;
  }

  .line {
    position: absolute;
    background: red;
    cursor: move;
  }

  .h-line {
    height: 2px;
    width: 100%;
  }

  .v-line {
    width: 2px;
    height: 100%;
  }
</style>
</head>
<body>

<!-- ì™¼ìª½ ì‚¬ìš©ë²• ì„¤ëª…ë€ -->
<div id="sidebar">
  <h2>ğŸ“Œ ì‚¬ìš©ë²• ìš”ì•½</h2>
  <p>1ï¸âƒ£ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”.</p>
  <p>2ï¸âƒ£ ì´ë¯¸ì§€ ìœ„ì—ì„œ í´ë¦­í•˜ì—¬ ë¶„í• ì„ ì„ ì¶”ê°€í•©ë‹ˆë‹¤.</p>
  <ul>
    <li>ì¼ë°˜ í´ë¦­ â†’ <b>ê°€ë¡œì„ (ë¹¨ê°„)</b></li>
    <li>Shift + í´ë¦­ â†’ <b>ì„¸ë¡œì„ (ë¹¨ê°„)</b></li>
    <li>Alt + í´ë¦­ â†’ <b>ê°€ê¹Œìš´ ì„  ì‚­ì œ</b></li>
  </ul>
  <p>3ï¸âƒ£ ì„ ì„ ë“œë˜ê·¸í•˜ë©´ ìœ„ì¹˜ ì´ë™ ê°€ëŠ¥</p>
  <p>4ï¸âƒ£ ì˜¤ë¥¸ìª½ ìœ„ <b>Export JSON</b> ë²„íŠ¼ì—ì„œ  
     ìœ„ì¹˜ ì •ë³´(í”½ì…€/í¼ì„¼íŠ¸) í™•ì¸ ê°€ëŠ¥</p>
</div>

<!-- ë©”ì¸ ì˜ì—­ -->
<div id="main">
  <div id="controls">
    <input type="file" id="imageInput" accept="image/*" />
    <button id="exportJsonBtn">Export JSON</button>
  </div>

  <div id="canvas-container">
    <img id="uploadedImage" src="" />
  </div>
</div>

<script>
  const container = document.getElementById("canvas-container");
  const image = document.getElementById("uploadedImage");
  const imageInput = document.getElementById("imageInput");
  const exportBtn = document.getElementById("exportJsonBtn");

  let lines = [];

  // ì´ë¯¸ì§€ ì—…ë¡œë“œ
  imageInput.addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) return;
    const url = URL.createObjectURL(file);
    image.src = url;
  });

  // ì´ë¯¸ì§€ í´ë¦­ â†’ ì„  ìƒì„± / ì‚­ì œ
  container.addEventListener("click", e => {
    if (!image.src) return;

    const rect = container.getBoundingClientRect();
    const x = e.clientX - rect.left + container.scrollLeft;
    const y = e.clientY - rect.top + container.scrollTop;

    // Alt í´ë¦­ â†’ ê°€ì¥ ê°€ê¹Œìš´ ì„  ì‚­ì œ
    if (e.altKey) {
      let nearest = null;
      let nearestDist = Infinity;
      for (let line of lines) {
        let dist = 0;

        if (line.type === "h") dist = Math.abs(line.elem.offsetTop - y);
        else dist = Math.abs(line.elem.offsetLeft - x);

        if (dist < nearestDist) {
          nearestDist = dist;
          nearest = line;
        }
      }
      if (nearest) {
        nearest.elem.remove();
        lines = lines.filter(l => l !== nearest);
      }
      return;
    }

    // Shift í´ë¦­ â†’ ì„¸ë¡œì„  ìƒì„±
    if (e.shiftKey) {
      createLine("v", x);
      return;
    }

    // ì¼ë°˜ í´ë¦­ â†’ ê°€ë¡œì„  ìƒì„±
    createLine("h", y);
  });

  // ì„  ìƒì„± í•¨ìˆ˜
  function createLine(type, pos) {
    const line = document.createElement("div");
    line.classList.add("line");

    if (type === "h") {
      line.classList.add("h-line");
      line.style.top = pos + "px";
      line.style.left = "0px";
    } else {
      line.classList.add("v-line");
      line.style.left = pos + "px";
      line.style.top = "0px";
    }

    container.appendChild(line);

    const lineObj = { type, elem: line };
    lines.push(lineObj);

    // ë“œë˜ê·¸ ì´ë™ ê¸°ëŠ¥
    line.addEventListener("mousedown", e => {
      e.preventDefault();
      const startY = e.clientY;
      const startX = e.clientX;
      const startTop = line.offsetTop;
      const startLeft = line.offsetLeft;

      function onMove(ev) {
        if (type === "h") {
          line.style.top = startTop + (ev.clientY - startY) + "px";
        } else {
          line.style.left = startLeft + (ev.clientX - startX) + "px";
        }
      }

      function onUp() {
        document.removeEventListener("mousemove", onMove);
        document.removeEventListener("mouseup", onUp);
      }

      document.addEventListener("mousemove", onMove);
      document.addEventListener("mouseup", onUp);
    });
  }

  // JSON Export
  exportBtn.addEventListener("click", () => {
    if (!image.src) return;

    const imgWidth = image.width;
    const imgHeight = image.height;

    const result = lines.map(l => {
      const px = l.type === "h" ? l.elem.offsetTop : l.elem.offsetLeft;
      const percent = l.type === "h"
        ? (px / imgHeight) * 100
        : (px / imgWidth) * 100;

      return {
        type: l.type,
        pixel: px,
        percent: percent.toFixed(2)
      };
    });

    alert(JSON.stringify(result, null, 2));
  });
</script>

</body>
</html>
